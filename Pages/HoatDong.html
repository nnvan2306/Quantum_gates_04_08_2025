<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <title>HO·∫†T ƒê·ªòNG</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="../css/styles.css" />

        <style>
            #button_control {
                background: #e53935;
                color: #fff;
                border: none;
                padding: 10px 20px;
                font-weight: 600;
                font-size: 14px;
                border-radius: 12px;
                cursor: pointer;
                box-shadow: 0 6px 16px -4px rgba(229, 57, 53, 0.6);
                transition: transform 0.1s, filter 0.1s;
                display: inline-block;
                line-height: 1;
            }
            #button_control:hover {
                filter: brightness(1.05);
                transform: translateY(-1px);
            }
            #button_control:active {
                transform: translateY(1px);
                box-shadow: 0 4px 12px -2px rgba(229, 57, 53, 0.6);
            }
        </style>
    </head>
    <body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col">
        <!-- Header -->
        <header
            class="bg-black text-white p-4 flex justify-between items-center"
        >
            <div class="text-xl font-bold">QUANTUM GATES</div>
            <nav class="space-x-6 text-sm">
                <a href="index.html" class="hover:underline">Trang ch·ªß</a>
                <a href="Congluongtu.html" class="hover:underline"
                    >C·ªïng l∆∞·ª£ng t·ª≠</a
                >
                <a href="BaiViet.html" class="hover:underline">B√†i vi·∫øt</a>
                <a href="HoatDong.html" class="hover:underline">Ho·∫°t ƒë·ªông</a>
                <a href="Sukien.html" class="hover:underline">S·ª± ki·ªán</a>
                <a href="LienHe.html" class="hover:underline">Li√™n h·ªá</a>
                <a href="HoiVien.html" class="hover:underline">H·ªôi vi√™n</a>
                <button id="button_control"></button>
            </nav>
        </header>

        <!-- Main -->
        <main class="flex-grow max-w-5xl mx-auto py-12 px-4">
            <h1 class="text-3xl font-bold mb-8 text-center text-amber-600">
                üèóÔ∏è Ho·∫°t ƒë·ªông & D·ª± √°n
            </h1>

            <!-- Loading State -->
            <div id="loading" class="text-center py-8">
                <div
                    class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-500 mx-auto"
                ></div>
                <p class="mt-4 text-gray-600">ƒêang t·∫£i ho·∫°t ƒë·ªông...</p>
            </div>

            <!-- Error State -->
            <div
                id="error"
                class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative"
                role="alert"
            >
                <strong class="font-bold">L·ªói! </strong>
                <span id="error-message" class="block sm:inline"
                    >Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ho·∫°t ƒë·ªông.</span
                >
                <button
                    onclick="loadActivities()"
                    class="absolute top-0 bottom-0 right-0 px-4 py-3"
                >
                    <span class="text-red-600 hover:text-red-800">Th·ª≠ l·∫°i</span>
                </button>
            </div>

            <!-- Activities Grid -->
            <div
                id="activities-grid"
                class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"
            >
                <!-- Activities will be dynamically inserted here -->
            </div>

            <!-- No Activities State -->
            <div id="no-activities" class="hidden text-center py-12">
                <p class="text-gray-500">Hi·ªán ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o.</p>
            </div>

            <script>
                // Include Post Interactions JS
                document.write(
                    '<script src="../Js/postInteractions.js"><\/script>'
                );
            </script>

            <script>
                // API Base URL - Update this to your actual API URL
                // const API_BASE_URL = 'http://localhost:3001/api';

                // Format difficulty level to Vietnamese
                function formatDifficulty(level) {
                    const levels = {
                        beginner: "C∆° b·∫£n",
                        intermediate: "Trung c·∫•p",
                        advanced: "N√¢ng cao",
                        expert: "Chuy√™n gia",
                    };
                    return levels[level] || level;
                }

                // Format activity type to Vietnamese
                function formatActivityType(type) {
                    const types = {
                        simulation: "M√¥ ph·ªèng",
                        exercise: "B√†i t·∫≠p",
                        quiz: "C√¢u ƒë·ªë",
                        experiment: "Th√≠ nghi·ªám",
                        tutorial: "H∆∞·ªõng d·∫´n",
                        challenge: "Th·ª≠ th√°ch",
                    };
                    return types[type] || type;
                }

                // Format duration to hours and minutes
                function formatDuration(minutes) {
                    if (!minutes) return "";
                    const hours = Math.floor(minutes / 60);
                    const mins = minutes % 60;
                    return hours > 0
                        ? `${hours} gi·ªù ${mins} ph√∫t`
                        : `${mins} ph√∫t`;
                }

                // Create activity card HTML
                function createActivityCard(activity) {
                    const difficulty = activity.difficulty
                        ? `<span class="px-2 py-1 text-xs rounded-full ${getDifficultyColor(
                              activity.difficulty
                          )}">
            ${formatDifficulty(activity.difficulty)}
          </span>`
                        : "";

                    const activityType = activity.activity_type
                        ? `<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">
            ${formatActivityType(activity.activity_type)}
          </span>`
                        : "";

                    // Add interaction controls
                    const interactionControls = createInteractionControls(
                        activity.id,
                        "activity"
                    );

                    const duration = activity.duration
                        ? `<div class="flex items-center text-sm text-gray-600">
            <span class="mr-1">‚è±Ô∏è</span> ${formatDuration(activity.duration)}
          </div>`
                        : "";

                    const points = activity.points
                        ? `<div class="flex items-center text-sm text-amber-600">
            <span class="mr-1">üèÜ</span> ${activity.points} ƒëi·ªÉm
          </div>`
                        : "";

                    return `
          <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition">
            <div class="p-6">
              <div class="flex justify-between items-start mb-3">
                <h3 class="text-lg font-semibold text-gray-900">
                  ${activity.title || "Kh√¥ng c√≥ ti√™u ƒë·ªÅ"}
                </h3>
                <div class="flex space-x-2">
                  ${difficulty}
                  ${activityType}
                </div>
              </div>
              
              <p class="text-gray-600 text-sm mb-4">
                ${activity.description || "Kh√¥ng c√≥ m√¥ t·∫£"}
              </p>
              
              <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
                <div class="flex items-center space-x-2">
                  <span>‚è±Ô∏è ${formatDuration(activity.duration)}</span>
                </div>
                <button class="text-amber-600 hover:text-amber-700 font-medium">
                  Xem chi ti·∫øt ‚Üí
                </button>
              </div>
              
              <!-- Interaction Controls -->
              ${interactionControls}
            </div>
          </div>
        `;
                }

                // Get color based on difficulty level
                function getDifficultyColor(level) {
                    const colors = {
                        beginner: "bg-green-100 text-green-800",
                        intermediate: "bg-blue-100 text-blue-800",
                        advanced: "bg-yellow-100 text-yellow-800",
                        expert: "bg-red-100 text-red-800",
                    };
                    return colors[level] || "bg-gray-100 text-gray-800";
                }

                // Load activities from API
                async function loadActivities() {
                    const loadingEl = document.getElementById("loading");
                    const errorEl = document.getElementById("error");
                    const noActivitiesEl =
                        document.getElementById("no-activities");
                    const activitiesGrid =
                        document.getElementById("activities-grid");

                    // Show loading, hide others
                    loadingEl.classList.remove("hidden");
                    errorEl.classList.add("hidden");
                    noActivitiesEl.classList.add("hidden");
                    activitiesGrid.innerHTML = "";

                    try {
                        // Fetch activities from API (filter by post_type='activity' and status='published')
                        const response = await fetch(
                            `${API_BASE_URL}/posts?post_type=activity&status=published`
                        );

                        if (!response.ok) {
                            throw new Error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu ho·∫°t ƒë·ªông");
                        }

                        const data = await response.json();

                        // Hide loading
                        loadingEl.classList.add("hidden");

                        if (
                            data.data &&
                            data.data.posts &&
                            data.data.posts.length > 0
                        ) {
                            // Add activities to the grid
                            data.data.posts.forEach((activity) => {
                                activitiesGrid.innerHTML +=
                                    createActivityCard(activity);
                            });
                        } else {
                            // No activities found
                            noActivitiesEl.classList.remove("hidden");
                        }
                    } catch (error) {
                        console.error("Error loading activities:", error);
                        loadingEl.classList.add("hidden");
                        document.getElementById("error-message").textContent =
                            error.message || "ƒê√£ x·∫£y ra l·ªói khi t·∫£i ho·∫°t ƒë·ªông";
                        errorEl.classList.remove("hidden");
                    }
                }

                // Load activities when page loads
                document.addEventListener("DOMContentLoaded", loadActivities);
            </script>
        </main>

        <!-- Footer -->
        <footer
            class="bg-black text-white p-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"
        >
            <div>
                <h3 class="font-bold mb-2">V·ªÄ CH√öNG T√îI</h3>
                <p>Li√™n h·ªá: quantumgates@example.com</p>
                <p>Ch√≠nh s√°ch</p>
            </div>
            <div>
                <h3 class="font-bold mb-2">C·ªîNG L∆Ø·ª¢NG T·ª¨</h3>
                <p>Hadamard</p>
                <p>Pauli-X</p>
            </div>
            <div>
                <h3 class="font-bold mb-2">T√ÄI NGUY√äN</h3>
                <p>T√†i li·ªáu h·ªçc</p>
                <p>Bi·ªÉu ƒë·ªì tr·∫°ng th√°i</p>
            </div>
            <div>
                <h3 class="font-bold mb-2">LI√äN H·ªÜ</h3>
                <p>Tr∆∞·ªùng ƒê·∫°i h·ªçc K·ªπ thu·∫≠t - C·∫ßn Th∆°</p>
                <p>SƒêT: 0385 316 325</p>
            </div>
        </footer>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const btn = document.getElementById("button_control");
                if (!btn) return;

                const token = localStorage.getItem("token");

                const setLogout = () => {
                    btn.textContent = "ƒêƒÉng xu·∫•t";
                    btn.onclick = () => {
                        localStorage.removeItem("token");
                        location.reload();
                    };
                };

                const setLogin = () => {
                    btn.textContent = "ƒêƒÉng nh·∫≠p";
                    btn.onclick = () => {
                        window.location.href = "/Pages/DangNhap.html";
                    };
                };

                if (token) {
                    setLogout();
                } else {
                    setLogin();
                }
            });
        </script>
    </body>
</html>
